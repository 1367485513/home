---
layout: default
---

# RISC-V 双周简报 (2018-03-02)

要点新闻：

## RV新闻
### Debug spec 进入45天的 public review
经过一年左右，debug spec最近进入了45天的 public review期间，按照基金会的规则，45天完后就会做ratification，标准就会确定下来。对debug spec 有兴趣的朋友可以针对debug spec给予反馈。这是RISC-V 标准中，第一个进入public review的部分。随着越来越多多核risc-v cpu 出现，小编也期待memory model 的部分能早日进入45天的public review。

- 更多细节请参考：[ RISC-V Debug Spec Public Review](https://groups.google.com/a/groups.riscv.org/d/msgid/isa-dev/CAKnTnFQs%2BaG9u%3DPG%3DbQK%3DACVNe06jtWf4dXELsAnd3yP_yQgcg%40mail.gmail.com?utm_medium=email&utm_source=footer)

## 開源軟件更新

### risc-v gdb patch v2
在工具链(gcc,llvm,gdb,glibc,binutils,newlib)中，risc-v的 gdb port一直是个缺乏关注的环节，embecosm 的 Andrew Burgess 最近开始针对gdb 提交patch。期待 gdb 也能早日合併主线。

- Link:[PATCHv2 gdb: Initial baremetal riscv support](https://sourceware.org/ml/gdb-patches/2018-02/msg00409.html)

### QEMU patch v7
来自 SiFive 的 Michael Clark 持续的在提交 QEMU patch，并在最近针对合併主线，做了一次port submission。

- 更多细节可以参考 Michael 所贴的status update:[QEMU status update](https://groups.google.com/a/groups.riscv.org/forum/#!topic/sw-dev/x25mwK4QCpU)

### Fedora/RISC-V: Runnable stage 4 disk images
Richard 持续的推进fedora bootstrap的情况下，目前的 fedora 有 bootable disk images了。按照Richard整理的结果，目前这个port包含：

- OpenSSH server
- dnf repository offering about 6000 packages
- most Fedora @Core packages
- Perl 5.26
- Python 2.7 & Python 3.6
- GCC 7.3.1
- systemmd

如果想要尝试一个简单的linux distribution，可以使用这个 port。除了Fedora以外，debian这端，也有非常多的bug report，看来两个linux distribution 在risc-v 这块都有不少进展。
- 更多细节可以参考:[Fedora/RISC-V: Runnable stage 4 disk images](https://rwmj.wordpress.com/2018/02/15/fedora-risc-v-runnable-stage-4-disk-images/)

## 技术讨论

### 由支持运行时关闭RVC支持而引发的一系列问题

RVC，即RISC-V得压缩指令集，是一个非常有用的RISC-V指令级扩展。
在支持RVC的处理器上，有可能需要临时关闭RVC支持。
其具体操作就是清除misa.C比特。
在清除misa.C比特后，处理器应该严格执行32比特指令并要求指令对齐32比特地址。

最先由形式化工作组提出，关闭RVC操作会引发未定义的行为。
这种未定义的行为简单来说有两个：

- 如果清除misa.C比特的CSRW指令不在32比特对齐的地址上，紧接着的下一条指令有可能发生地址不对齐的错误。
- 如果清除misa.C比特的CSRW指令发生在异常响应程序中，而此时mepc中保存着一个非对齐的异常返回地址，那么过一会儿mret时也会发生未对齐错误。

这里大家在激烈争论的问题是，如果出现这种情况，到底算哪一条指令出现了异常。比如对第一个问题，到底是算CSRW指令错误，还是后续的指令非对齐错误？

根据现在的修改[预案](https://github.com/riscv/riscv-isa-manual/pull/139)，解决方案大致如下：
 
- 如果清除misa.C比特的CSRW指令没有对齐，CSRW指令会清除misa.C比特。但是后面的指令会报出地址不对齐异常。mepc会记录非对齐的指令地址。
- 如果misa.C被清除后，mret跳回直一个非对齐地址，mret指令正常完成，并且系统优先级返回异常发生时的优先级，然后报mepc所指向的指令地址非对齐错误。
- 如果jmp和branch试图在misa.C为低的时候将pc置为非对齐地址，立即报jmp和branch指令错误。

这里就有些不对称的问题了。mret也是跳转，却总是正确完成，报后面指令的地址错误。而jmp/branch却会报当前指令的错误。
这里的问题是，如果mret指令会引发异常，将会破坏硬件的异常处理，有可能导致不能在异常处理后正确返回异常之前的优先级。
jmp和branch指令立即发生异常，则是为了能更好的调试。
如果jmp和branch将pc设为非对齐地址，而报后面指令错误。发生错误时很难发现错误的原因是跳转错了地址。

- [修改预案](https://github.com/riscv/riscv-isa-manual/pull/139)
- [isa-dev的讨论](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/xvipMQ3lYRY/UDk3FO8ICwAJ)

### RDCYCLE的意义

鉴于最近Krste在ISA标准中解释了hart的定义，Liviu Ionescu提出了新问题：
“那么，RDCYCLE读取到的是一个处理器(processor core)执行的时钟周期数是不是不准确了呢？”
结果，为了解释这个，Krste准备又要在标准里加一大段解释了。
解释太长，具体看这里：https://github.com/riscv/riscv-isa-manual/issues/140#issuecomment-368856451

简单说呢，其实是这样的：
首先，RDCYCLE读到的是一个处理器core执行的时钟周期数而不是一个hart的周期数。
原因是因为一般的SMT处理器并不能严格获得一个hart所执行的周期数。
但这并不是一个问题。RDCYCLE本来就只是一个单调随时间正向增长的计数器。
这里的确是一个不准确的定义，但是这个定义的确也很难准确。
不准确的定义不代表就不能被定义。

### 进一步的缓存预取计划

Max Hayden Chiz在hw-dev列表中进一步细化了关于为Rocket-Chip(Rocket和BOOM)添加缓存硬件自动预取功能的计划，
并号召有时间的人一起来完成。
具体的计划可见[邮件列表](https://groups.google.com/a/groups.riscv.org/d/msg/hw-dev/53s3CiWOuD0/Z7_rdxnaCgAJ)。

进一步的讨论中又冒出了很多好点子。比如说Jacob提出我们可以找到32个寄存器中使用较多的几个寄存器，然后用硬件预测寄存器的步长。如果发现寄存器有固定步长变化，同时被用于访问内存，则可用于指导自动缓存预取（stride prefetch）。同时，为了防止预取被用于缓存侧信道攻击，预取的缓存块应该放入单独的缓存空间，只有当缓存块真的被访问才进入一级缓存。

- [具体计划](https://groups.google.com/a/groups.riscv.org/d/msg/hw-dev/53s3CiWOuD0/Z7_rdxnaCgAJ)
- [依据寄存器的stride prefetch](https://groups.google.com/a/groups.riscv.org/d/msg/hw-dev/53s3CiWOuD0/u2EuLqeNCwAJ)
- [预取侧信道](https://groups.google.com/a/groups.riscv.org/d/msg/hw-dev/53s3CiWOuD0/u2EuLqeNCwAJ)


## 代码更新

### 即将到来新的一轮Rocket-Chip变量名变更

一个设计的成熟度有时候其实依赖于很简单的东西，比如频繁使用的变量名在前后版本中保持一致。
不过，Rocket-Chip的设计者们决定，他们又要更名了。
这回：

- coreplex要更名为subsystem
- HasPeripheryBus的定义被BaseSubsystem涵盖
- Clint变大写为CLINT
- 各个bus被重名为：ibus, sbus, pbus 和 fbus

希望这回更名能持续的久一点。

- 具体的更名代码在Rocket-Chip的[PR \#1190](https://github.com/freechipsproject/rocket-chip/pull/1190)

## 安全点评

## 微群热点

## 实用资料

### All Aboard, Part 10: How to Contribute to the RISC-V Software Ecosystem
Palmer在这篇 blog 中整理了 RISC-V software eco 目前的状况。有兴趣採用risc-v的同学可以参考。

- Link:[All Aboard, Part 10: How to Contribute to the RISC-V Software Ecosystem](https://www.sifive.com/blog/2018/02/20/all-aboard-part-10-how-to-contribute-to-the-risc-v-software-ecosystem/)

## 行业视角

## 市场相关

### CEVA 加入 RISC-V 基金会


## CNRV社区活动

## CNRV网站更新


## 会议征稿

### 第八届 RISC-V Workshop Call for Papers
在西班牙举办的第八届RISC-V workshop开始徵稿了! 有兴趣的同学可以赶快把握机会！

- 连结:[8th RISC-V Workshop CFP](https://riscv.org/2018/02/8th-risc-v-workshop-reg-and-call-for-papers/)


## 暴走事件

### 二月

+ [FOSDEM'18](https://fosdem.org/2018/) 2018年2月3-4日，FOSDEM (Free and Open Source Developers’ European Meeting)将在比利时的布鲁塞尔举行。

+ [PULP WORKSHOP AT HPCA2018](http://pulp-platform.org/hpca2018) 2018年2月25日，在维也纳的HPCA中，会有一场跟Pulp 有关的workshop。PULP小组会介绍PULP最新的发展，和他们未来的走向，包括  PULP-CAPI (Coherent Accelerator Processor Interface) 和 Ariane （Next generation of 64-bit RISC-V implementations）等。详情可参考 pulpino mailing list 中的 < PULP newsletter - 4Q2017 >。

+ [Embedded World 2018](http://www.embedded-world.eu/program.html) 2018年2月27日，在德国 Nuremberg 的 Embedded world会有一整天跟RISC-V有关的演讲。包括 Microsemi, Mentor Graphics等公司都会给演讲。AMD的CTO Mark Papermaster 也会给一个 Conference Keynote。

### 三月
+ [OpenEmbedded/Yocto on RISC-V](https://elciotna18.sched.com/event/DXmn) 2018年3月12-14日，在ELC NA (Embedded Linux Conference North America 2018)，来自Comcast的 Khem Raj 会给一场关于 OpenEmbedded/Yocto on RISC-V的演讲。

### 五月

+ [8th RISC-V workshop](https://riscv.org/workshops/) 第八次RISC-V workshop将在5月7-10日在西班牙举办。

### 六月

+ **CNRV的成员和爱好者们正在RISC-V基金会的支持下筹备一场线下活动，时间暂定为2018年6月30日，目前暂定在复旦大学举行。有任何建议、意见和想法，都可以发邮件给群头 [<xfguo@xfguo.org>](mailto:xfguo@xfguo.org)。**

+ [2nd CARRV](https://carrv.github.io/) 第二次CARRV workshop(Computer Architecture Research with RISC-V ) 将在6月2日和ISCA 2018共同举办。


## 招聘简讯

_CNRV提供为行业公司提供公益性质的一句话的招聘信息发布，若有任何体系结构、IC设计、软件开发的招聘信息，欢迎联系我们！_

----

整理编集: 宋威、黄柏玮、郭雄飞


----

**欢迎关注微信公众号CNRV，接收最新最时尚的RISC-V讯息！**

![CNRV微信公众号](/assets/images/cnrv_qr.png)

----

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。

