---
layout: default
---

# RISC-V 双周简报 (2018-03-30)

要点新闻：


## RV新闻


## 技术讨论

### 兼容性测试的准则

RISC-V兼容性测试（compliance suites）是测试一个RISC-V处理器满足RISC-V标准的测试程序集，也是使用RISC-V trade mark的前提之一。
最近在关于处理器同时支持RV32和RV64时，必须支持的压缩指令集扩展的问题上，兼容性测试的设计准则问题被问了出来。
比如说，一个处理器号称支持RV64I，但是却将RV64M中的MUL指令用于了其他用途。这样的处理可以算作兼容吗？
根据Krste的解释，这也许是兼容的（如果小编理解正确了）：

> [isa-dev邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/z0I1IvQJOwM/idwYffZPCwAJ):
>
> Consensus is that compliance suites will need to have versions, and if
> at some later date, there's agreement on truly useful
> forward-compatibility checks, we can add them in later version.
>
> Meanwhile, we should stick to compliance tests only checking for
> existence and not checking for non-existence.

翻译：兼容测试会有版本来逐步确定前向兼容检查的具体内容。同时，我们应当坚持测试必须被支持的指令被正确支持了，而不是测试不被支持的指令没有被支持。

> [isa-dev邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/z0I1IvQJOwM/1tFUF4dHCwAJ):
>
> The compliance test should test for known illegal opcodes (16 0s, and
> ILEN bits of all 1s), but not for reserved opcodes.
>
> There is an important difference between reserved and custom opcodes.
> Future standards can never use "custom" opcodes, while "reserved" are
> reserved for future standards use.

翻译：兼容测试应该测试已知的非法操作数（指令）但并不检测被预留的操作数。预留操作数和可定制(custom)操作数有着重要区别。
将来的指令级扩展一定不会使用可定制操作数，但是预留操作数则是专门为将来的指令预留的。

在讨论的过程中，也冒出这么一个有趣的[问题](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/z0I1IvQJOwM/7lO2_QVUCwAJ)：

> I asked if the RISC-V Foundation would agree (in
> writing) to indemnify contributors (in the instance where the use of a
> compliance-conformant processor resulted in the death of a person, and
> the RISC-V Foundation was sued, would the RISC-V Foundation agree not
> to sue the contributors?), but i have not received a response.

翻译：我（提问者）问过基金会。基金会是否会保护贡献者（如果一个兼容测试通过的处理器导致了一个伤亡事故，基金会被告了，基金会会追究兼容测试集贡献者的责任吗？）基金会没有回答。

### J 扩展指令集的讨论

J扩展指令集是指专门来加速即时编译JIT的指令集扩展，现在正在由J扩展指令集工作小组讨论开发中。
最近邮件列表上对J指令集扩展的研究内容进行了一番讨论，其中谈到了ARM的Jazelle指令集扩展和中国的龙芯，还挺有意思的。

ARM的Jazelle扩展指令集是用来动态解释执行Java字节码的ARM扩展指令(https://en.wikipedia.org/wiki/Jazelle)，
后来被称为DBX(Direct Bytecode eXecution)。
现在据说用处不多了，原因是：“苹果不让iphone运行JAVA!” [[Martin Schoeberl的邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/I3jOT_ZmC8U/kCj1GrNBCgAJ)]
不过当年，基本所有运行塞班系统（大家都知道Symbian吧？）的手机都使用Jazelle来运行JAVA。
如果比较Jazelle的运行时解释执行和使用JIT的即时编译执行，当JIT的内存使用量小于4MB时，Jazelle的效率更高[[David Chisnall的邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/I3jOT_ZmC8U/8whXoacVCgAJ)]。
看来，硬件加速的解释执行在小内存系统中是非常必要的。
即使在使用JIT的系统中，加速的解释执行对提高用户体验也是非重要的。

David Chisnall建议RISC-V的J指令集扩展应该要解决这几个问题[[David Chisnall的邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/I3jOT_ZmC8U/kMLyuTQVCgAJ)]：

* 随着多核的普及，很多以往单线程性能良好的JIT需要能高性能的移植到多核系统中。
* 网页应用对网页的加载速度敏感。然而JIT的高效编译依赖于代码的重复执行，第一次执行往往效率低下。我们需要更好的初次执行性能（low-tier JITs）。
* 以往被认为资源受限的系统也开始使用高级语言，比如物联网的端节点。其中一个原因时使用高级语言来避免内存错误（安全问题）。这就需要硬件加速的解释执行。
* 在现在的内存带宽容量下，我们可以重新思考垃圾回收机制的加速。

在相关的讨论中，计算所的龙芯也被提及。龙芯运行的是扩展的MIPS指令集。为了能更高效地仿真(emulate)x86指令，龙芯用扩展指令实现了接近200多条的x86浮点运算指令，将使用QEMU仿真执行x86测试程序的性能提高到了使用x86处理器执行的70%左右。(https://en.wikipedia.org/wiki/Loongson#Hardware-assisted_x86_emulation)

另外，小编也注意到，在JIT中，为了让新的代码能在缓存裡，是不是也该加上能把旧代码踢出缓存的指令呢(Cache Invalidate)？虽说如此， 但RISC-V 希望能对于硬件透明。因此，这部分未来如何进行，也是小编很感兴趣的地方。

### 直接缓存操作的安全问题

直接缓存操作，比如说flush和preload操作，可以被攻击者用来完成基于缓存的侧信道攻击。
高性能缓存对缓存直接操作的需求和系统安全的需求在这里便成为了直接冲突。
直接缓存操作如何在这两种需求中折衷还需认真讨论。

这两周，邮件列表上针对第5版直接缓存操作的安全问题有了较深入的讨论。
现在的讨论重点，集中于破坏性缓存操作。

比如，MEM.DISCARD 直接失效缓存区域（数据丢失，用于抛弃无用数据而避免写回）。
如果这些被软件认为是无用的数据可以被攻击者用来泄露关键信息，那么需要在抛弃数据后将数据置为无效值（比如清零）。
但是，清零之后需要将数据写回内存吗？有人认为这是必须的，因为内存中可能存在数据的旧值，攻击者可以利用非一致性的DMA从内存中读回旧值。
不过，熟悉操作系统的人说，现在的操作系统是不会允许用户态程序直接操作非一致性的DMA，所以这种担心是多余的。
好像都有道理。

- Albert Cahalan 认为存在侧信道的[邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/4skJJjphi60/6wCF1wJzAgAJ)
- Christoph Hellwig 认为这不太会是个问题的[邮件](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/4skJJjphi60/rCxveBknAwAJ)


## 代码更新

## 安全点评

## 微群热点

## 实用资料

## 行业视角

## 市场相关


## CNRV社区活动

## CNRV网站更新

## 会议征稿


## 暴走事件

### 五月

+ [8th RISC-V workshop](https://riscv.org/workshops/) 第八次RISC-V workshop将在5月7-10日在西班牙举办。

### 六月

+ **CNRV的成员和爱好者们正在RISC-V基金会的支持下筹备一场线下活动，时间暂定为2018年6月30日，目前暂定在复旦大学举行。有任何建议、意见和想法，都可以发邮件给群头 [<xfguo@xfguo.org>](mailto:xfguo@xfguo.org)。**

+ [2nd CARRV](https://carrv.github.io/) 第二次CARRV workshop(Computer Architecture Research with RISC-V ) 将在6月2日和ISCA 2018共同举办。


## 招聘简讯

_CNRV提供为行业公司提供公益性质的一句话的招聘信息发布，若有任何体系结构、IC设计、软件开发的招聘信息，欢迎联系我们！_

----

整理编集: 宋威、黄柏玮、郭雄飞


----

**欢迎关注微信公众号CNRV，接收最新最时尚的RISC-V讯息！**

![CNRV微信公众号](/assets/images/cnrv_qr.png)

----

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。

