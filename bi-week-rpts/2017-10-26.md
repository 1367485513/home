---
layout: default
---

# RISC-V 双周简报 (2017-10-26)

要点新闻：

- [蜂鸟E200系列处理器发布](#蜂鸟e200系列处理器发布)
- [CARRV論文发布](#carrv論文发布)
- [7th RISC-V workshop workshop议程发布](#7th-risc-v-workshop议程发布)
- [使用编译参数在汇编代码中选择性地使用RVC压缩指令](#使用编译参数在汇编代码中选择性地使用rvc压缩指令)
- [破坏执行中函数调用和函数返回严格配对的主要原因](#破坏执行中函数调用和函数返回严格配对的主要原因)
- [IQ-Analog的14nm芯片使用了RISC-V 的 CPU](#iq-analog的14nm芯片使用了risc-v-cpu)

## RV新闻

### 蜂鸟E200系列处理器发布

由武汉聚芯微电子有限公司和北京九天卫星科技发展有限公司联合开发的蜂鸟E200系列处理器正式发布。
> - 处理器核采用2级流水线结构，功耗与面积均优于同级ARM Cortex-M0+核。
> - 处理器核能够运行RISC-V指令集，支持RV32I/E/A/M/C/F/D等指令子集的配置组合，只支持机器模式。
> - 蜂鸟E200主要面向极低功耗与极小面积的场景而设计，非常适合于替代传统的8051内核或者Cortex-M系列内核应用于IoT或其他低功耗场景。

### 7th RISC-V workshop议程发布
7th workshop的议程发布了，内容包括 RISC-V 架构丶软件丶硬件丶模拟环境丶应用等各个面向。GF, Lauterbach, Express Logic (ThreadX RTOS)及许多公司都会带来演讲。

#### 完整议程请见：[link](https://riscv.org/2017/10/7th-risc-v-workshop-agenda/)


### IQ-Analog的14nm芯片使用了RISC-V CPU
IQ-Analog的Ken在先前宣布了他们公司的 14nm 芯片，有採用 ETH-Zurich 及picorv32的RISC-V核。最近，test chip回来了，并在200MHz下部分的测试成功。Ken在讨论区中介绍了他们的配置，并感谢社群对RISC-V的支持和维护。恭喜他们 : )

> At IQ-Analog, we received our first ever GF 14nm ASIC test chip a couple of weeks ago and assembled evaluation boards >containing the chip this past Thursday.  After a bit of a slow startup, we were able to download and execute code yesterday >via JTAG to both the NanoRisc5 (in-house grown picorv32 variant with debug spec 0.9 debugging added) and the ETH-Zurich >versions of the RISC-V cores!
> While we have not bought up the 1GHz clock source yet to test full speed operation (1 GHz for NanoRisc5, 500 Mhz for ETH- >Zurich), we have been able to conduct these initial tests using a slower 200 MHz "debug clock input" path.  We still have a >lot of things to bring up and test on this ASIC, but I wanted to share the news of working RISC-V cores in 14nm and extend a >thank you to everyone in the RISC-V community for developing the RISC-V architecture and intrastucture.

#### 讨论连结：[link](https://groups.google.com/a/groups.riscv.org/d/msgid/hw-dev/59E3AB57.8090601%40gmail.com)

### OSDT中关於 RISC-V 和 coreboot 的演讲
最近结束的OSDT2017开源开发工具大会中有一场跟RISC-V有关的演讲。来自 HardenedLinux 的王翔给大家带来了主题为《RISC-V架构下的coreboot》的演讲。王翔在其中介绍了coreboot移植到 HiFive1 的经验。目前投影片已释出。

#### 投影片连结：[link](https://github.com/hellogcc/OSDT2017)

### Microsemi 发布 Mi-V 嵌入式整合方案
Microsemi最近发布了针对RISC-V 生态圈 的 Mi-V整合方案，将 Design tools, board, OS, RISC-V soft CPU 等一起整合起来。OS方面合作的厂商包括 Huawei LiteOS, Micrium µC OSIII 和 ThreadX，同时也支援FreeRTOS。Microsemi 希望藉由这样的整合加速RISC-V生态圈的发展。

#### 新闻连结：[link](https://www.prnewswire.com/news-releases/microsemi-launches-mi-v-ecosystem-to-accelerate-adoption-of-risc-v-300538684.html)

## 技术讨论

### 使用编译参数在汇编代码中选择性地使用RVC压缩指令

在全局禁止使用RVC指令的时候，汇编代码可以通过在代码中局部地启用RVC编译参数来启用压缩指令。
在如下的例子中：

```asm
.option push;
.option rvc; 
    c.addi a0, 1;
    c.slli a0, 1;
.option pop
```

在`.option rvc;`和`.option pop`之间便可以使用RVC指令。而之外的部分，则会只能使用正常指令集。

Andrew Waterman举的例子：[https://goo.gl/iMoTy1](https://groups.google.com/a/groups.riscv.org/d/msg/sw-dev/ShgP4nXkKQE/39r5PyUfBQAJ)

### 破坏执行中函数调用和函数返回严格配对的主要原因

在使用控制流一致性（CFI）保护系统安全的方法中，利用硬件或软件的影子栈来跟踪合法的函数调用是一个重要方法。
但是显式操作系统和软件的函数调用与函数返回并不是严格配对的。有的时候一个返回可能回调多个函数的压栈。
最近邮件列表中便问到了这样的问题。导致这种不一致性的主要原因是什么。Andrew的回答还是非常清楚的。
对于RISC-V来说，主要原因是长跳转（longjmp/setcontext）

> Tail calls don't generally lead to unmached call-return pairs; the
> tail-callee's return will match the original call.
>
> The main thing that screws up the return-address stack is context
>switching (in the kernel, or in userspace via longjmp/setcontext).

不明白这里长跳转的同学请脑补longjmp。这是迅速异常处理和可重入的一个重要概念。

邮件列表的讨论：[https://goo.gl/sPTvvu](https://groups.google.com/a/groups.riscv.org/d/msg/sw-dev/8aorX2MraBE/R99kPUTjAwAJ)

### 在反汇编中使用原始机器指令和机器寄存器

使用objdump对可执行文件进行反汇编默认使用宏指令代替特殊指令（比如用`li a5, 3`代替`addi x15, x0, 3`）和使用ABI寄存器命名代替机器命名（用`a5`替代`x15`）。如果需要反汇编成最原始的机器代码和机器寄存器，可以使用` --disassembler-options=no-aliases,numeric`参数。

邮件列表中的讨论：[https://goo.gl/As1jec](https://groups.google.com/a/groups.riscv.org/d/msg/sw-dev/Z2MheQOf_Tc/3sQ6SQPxAgAJ)

## 代码更新

### Rocket-Chip 初步支持覆盖

Rocket-Chip 最近在Chisel代码中加入了对覆盖(cover)的支持。覆盖是硬件测试的基本概念。覆盖率用来检测仿真是否触发了各个信号的所有编码状态或控制逻辑的所有分支。不过现在的覆盖支持看起来还刚刚开始，被标注为覆盖检测的信号并不会真的计算覆盖率。也或许SiFive已经在内部测试简单的覆盖支持。

Rocket-Chip PR \#998 [https://git.io/vd7D3](https://github.com/freechipsproject/rocket-chip/pull/998)

### BOOM 支援了更好的 WFI实现
在最近 devel branch的一次更新中，BOOM有了不少更新，包括实作了 sfence.vma，以及将WFI做了更好的实现。WFI (Wait for Interrupt）是个让处理器能进入低功耗状态的指令。先前的BOOM是用 NOP 来实作WFI，pipeline并没有停止。这次，WFI将会触发 csr\_stall 这个讯号。这个讯号会被接到ROB中，使 ROB的 commit 停止，藉由这样来达到停止pipeline的效果。

#### BOOM devel branch的重要commit: [link](https://github.com/ucb-bar/riscv-boom/commit/98c60153c6c49e15aeb5664d702755dd6295fc7d)
#### BOOM 的issue 17：[link](https://github.com/ucb-bar/riscv-boom/issues/17)


## 安全点评

## 微群热点

## 实用资料

### CARRV論文发布

CARRV (First Workshop on Computer Architecture Research with RISC-V) 的論文发佈了。这次的内容涵盖 rv 的各个面向，模拟器（gem5)、SIMT、rv8二进制转换器、rocket-chip的 diplomacy pattern 等都有包括。感觉未来用RV当作平台的研究将越来越多。

#### 详细的论文连结可参考：[https://carrv.github.io/]

### Spike Internal 文档
黄柏玮正在努力理解 Spike (risc-v的指令集模拟器）内部实作，并将其整理成文档。其目的是让众多研究者和工程师针对模拟器及指令集做延伸时能更加容易从Spike 修改和模拟。最近，文档也将整合Evan Cox 所整理的 Spike reset/boot 的分析。阅读还在进行中，Spike 的代码也在不断更新 （譬如最近加上了Q extension)，因此阅读笔记也会适时更新。文档中如果出现错误，或者文档还没有覆盖的代码，也欢迎大家一起帮忙完成。

#### 文档连结: [link](https://github.com/poweihuang17/Documentation_Spike)
#### Evan Cox 关於 Spike boot/reset的整理：[link](https://github.com/riscv/riscv-isa-sim/issues/145)

#### Chisel 的学习资料：（Chisel Learning Journey）

虽然Chisel跟RISC-V不直接相关，但因为Rocket和BOOM都是用Chisel写的，还是有不少人想透过学chisel来更了解Rocket丶BOOM 和 RISC-V。 Intensivate公的Sean Halle 最近就组了个小组，一起编写了一份chisel的tutorial，叫 Chisel Learning Journey。希望利用sodor一步一步的带着大家先学会chisel，再慢慢往rocket和boom中所使用的高阶功能迈进。有兴趣学chisel的朋友可以参考参考。

#### Chisel Learning Journey的连结：[link](https://github.com/librecores/riscv-sodor/wiki/Chisel-Learning-Journey)

## 行业视角

## 市场相关

## CNRV社区活动

## CNRV网站更新

- [[3ac3e44](https://github.com/cnrv/home/commit/3ac3e440254393c5030766f153cecba334415994)]
  加入Berkeley课程页CS61C
- [[2c6dd26](https://github.com/cnrv/home/commit/2c6dd26f0e73f422df0ce2c2eeac26dcfebc4536)]
  双周简报问卷调查结果分析
- [[15df39a](https://github.com/cnrv/home/commit/15df39a2fbb1ed8c0aa251a76ec284f41437f110)]
  加入剑桥大学教学用处理器Clarvi
- [[e7122bb](https://github.com/cnrv/home/commit/e7122bb383f19dde3e545f8cd5e7aa262fc8e549)]
  加入黄柏玮逐步整理的Spike文档
- [[c2f3eeb](https://github.com/cnrv/home/commit/c2f3eeb3d23a5e01c9bc2b7e0f05f9d9003ca870)]
  加入"Chisel Learning Journey": 一个关于学习Chisel的资料搜集wiki
- [[628f063](https://github.com/cnrv/home/commit/628f063de8d4ba4a361999c91498ecbe6b6f28e7)]
  加入维基百科上的RISC-V词条

## 暴走事件

### 十一月

+ [BSDTW17](https://bsdtw.org/) 2017年11月11-12日，BSDTW17会有两场关于RISC-V的演讲，地点在台北。
+ [The 7th RISC-V workshop](https://www.softconf.com/h/riscv7thwkshp/) 2017年11月28-30日，第7届RISC-V研讨会将在美国加州Milpitas由西部数据承办。

## 招聘简讯

_CNRV提供为行业公司提供公益性质的一句话的招聘信息发布，若有任何体系结构、IC设计、软件开发的招聘信息，欢迎联系我们！_

----

整理编集: 宋威、黄柏玮、郭雄飞

----

**欢迎关注微信公众号CNRV，接收最新最时尚的RISC-V讯息！**

![CNRV微信公众号](/assets/images/cnrv_qr.png)

----

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。
