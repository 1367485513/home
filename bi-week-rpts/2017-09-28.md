---
layout: default
---

# RISC-V 双周简报 (2017-09-14)

## RV新闻

## 技术讨论

### 在RV32系统中，如何设定64位的时间比较寄存器timecmp

无论是在32位还是64位系统中，时间比较寄存器timecmp都是64位的，以保证其不会溢出。
出于对多核多电压以及电源关断的支持，时间比较寄存器不再是一个CSR，而是一个映射到IO地址空间上的系统寄存器。
当IO总线宽度小于64比特，比如32比特时，如何正确设定时间比较寄存器呢？
RISC-V priv spec如是说：

> "In RV32, memory-mapped writes to mtimecmp modify only one 32-bit part of the register."
>
> Figure 3.15 below shows a 'Sample code for setting the 64-bit time comparand in RV32 assuming the registers live in a strongly ordered I/O region.'
> 
> ~~~
>  	# New comparand is in a1:a0.
>         li t0, -1
>         sw t0, mtimecmp   # No smaller than old value.
>         sw a1, mtimecmp+4 # No smaller than new value.
>         sw a0, mtimecmp   # New value.
> ~~~

相关讨论：[https://goo.gl/pPjwom](https://groups.google.com/a/groups.riscv.org/forum/#!msg/isa-dev/dVQVKx7f8eE/KsHJAw01CAAJ)

### ecall和ebreak的返回地址

RISC-V在中断和异常时的返回地址定义是不同的。出现中断时，中断返回地址epc被指向下一跳指令，因为中断时的指令被正确执行。
出现异常时，epc则指向当前指令，因为当前指令触发了异常。
然而，如果异常由ecall或ebreak产生，直接跳回返回地址则会造成死循环（执行ecall导致重新进入异常）。
正确的做法是时在异常处理中手动改变epc指向下一条指令。现在ecall/ebreak都是4字节指令，因此简单设定`epc=epc+4`即可。
该问题很早以前就被提出过，最近又被重新提及。

相关讨论：[https://goo.gl/6CcZ8j](https://groups.google.com/a/groups.riscv.org/forum/#!msg/sw-dev/Mn_qEm_OTOI/PayhGy6gAQAJ)

## 代码更新

### Rocket-chip 的 L2 真的有死锁问题

这里的二级缓存是指的还在lowRISC和BOOM中使用的老版本的二级缓存实现。最新的Rocket-chip并不提供二级缓存。

还记得4周前有过讨论，[sxu55](https://github.com/sxu55)认为lowRISC所使用的L2存在死锁条件，但是那时候并没能找出死锁的具体原因。
经过近一个月的讨论和盘查，最终[sxu55]提供了一段简单代码复制死锁条件。经过确认的确死锁了。
lowRISC通过修改二级缓存中关于一级缓存写回缓存块部分的控制逻辑，解决了该死锁问题。
整个死锁的发生涉及接近6个相关报文按一个特殊的顺序发生，导致了二级缓存中的共享写回单元和处理一级缓存的回写模块发生互相等待。
解决办法是在死锁可能发生的状态调整报文优先级，让一级缓存的回写先完成。

这里还只是涉及两个处理器没有第三级缓存的缓存一致性实现，如果有了三级缓存，估计问题的复杂度还得高个数量级。
也许真的应该在设计缓存一致性控制模块之前，先建立行为模型，用形式验证的方法先证明没有死锁状况。

#### 具体讨论：[https://git.io/v5YAb](https://github.com/lowRISC/lowrisc-chip/issues/67)
#### 问题修复：[https://git.io/v5pNi](https://github.com/lowRISC/uncore/pull/4)

## 安全点评

## 微群热点

## 实用资料

## 行业视角

## 市场相关

## CNRV社区活动

## 暴走事件

### 十月

+ [OSDT开源开发工具大会2017](http://www.hellogcc.org/?p=34315)（也就是原HelloGCC会议）将在10月下旬在北京举办，时间暂定10月21日，话题和赞助征集已经开始。话题内容包括“面向RISCV等新硬件的基础软件支持”，各位不要错过。
+ [开源经济学研究-2017年年会邀请函](http://www.open-source-economics.org/open_source_economics_2017.html)
+ RISC-V at the [Linley Processor Conference](http://www.linleygroup.com/events/event.php?num=43), 4-5 October 2017 at Santa Clara, California.
+ [First Workshop on Computer Architecture Research with RISC-V (CARRV 2017)](https://carrv.github.io/#first-workshop-on-computer-architecture-research-with-risc-v-carrv-2017), 14 October at Boston, Massachusetts, co-located with MICRO 2017.
+ [LLVM US dev meeting](https://llvm.org/devmtg/2017-10/#bof4)将在十月18-19日于加州San Jose举行。其中有一场跟risc-v有关的演讲。Alex Bradbury演讲的主题会是 "Co-ordinating RISC-V development in LLVM"。 有兴趣的可以参考。

### 十一月

+ [The 7th RISC-V workshop](https://www.softconf.com/h/riscv7thwkshp/) 2017年11月28-30日，第7届RISC-V研讨会将在美国加州Milpitas由西部数据承办。
+ [BSDTW17](https://bsdtw.org/) 2017年11月11-12日，BSDTW17会有两场关于RISC-V的演讲，地点在台北。

## 招聘简讯

### lowRISC招聘硬件工程师

lowRISC是于2014年在剑桥成立的一家非盈利公司，致力于向中小企业和研究机构提供基于RISC-V和Rocket-Chip的开源多核片上系统。
现在lowRISC希望聘请一位硬件工程师。主要的研究方向是多核片上系统和硬件安全。具体的招聘广告请查看https://lowrisc.workable.com/j/DBAC61322F

----

整理编集: 宋威，郭雄飞，黄柏玮

----

**欢迎关注微信公众号CNRV，接收最新最时尚的RISC-V讯息！**

![CNRV微信公众号](/assets/images/cnrv_qr.png)

----

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。
