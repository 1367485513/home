---
layout: default
---

# RISC-V 双周简报 (2017-10-12)

## RV新闻

### SiFive发布第一款多核支援Linux的RISC-V IP
上周SiFive推出了U54-MC Coreplex，是RISC-V 生态圈中第一款支援Linux及多核的64bit RISC-V IP。SiFive将其和 ARM的A35比较。同时，SiFive也将在2018 Q1推出对应的开发版。其实讨论区和小编期待有这样的版子很久了。终於有个多核且64bit可以跑Linux的版子可以玩了。期待接下来有越来越多64bit和多核的RISC-V CPU或版子可以玩 :)

#### 连结: [SiFive網站](https://www.sifive.com/products/risc-v-core-ip/u54-mc/) , [slide from linley conf day1](http://www.linleygroup.com/events/agenda.php?num=43&day=1).

### Dover microsystems发布CoreGuard
Dover Microsystems发布了CoreGuard，一款基於RISC-V的硬件安全方案。RISC-V的一个优势在於，各个独特技术的小公司能基於RISC-V做各种创新。Dover Microsystems 先前还在Medium写了一篇 CoreGuard 跟Trustzone的比较。对硬件安全有兴趣的朋友可以参考。

#### CoreGuard的[連結](https://globenewswire.com/news-release/2017/10/04/1140783/0/en/Dover-Microsystems-Launches-CoreGuard.html)
#### Medium的文章：[link](https://medium.com/@dovermicrosystems/dover-coreguard-vs-arm-trustzone-2c0412c4bc75)
#### RISC-V Workshop上的slide:[link](https://riscv.org/wp-content/uploads/2016/01/Wed1430-dover_riscv_jan2016_v3.pdf)

### RISC-V @ 15th International SoC conference
本周在 Irvine 舉辦的 SoC conference有六场关於RISC-V的演讲。Microsemi, SiFive, Imperas Software, Codasip, UltraSoC, 和 prpl foundation都会来给关於RISC-V的演讲。比较特别的是prpl foundation，将带来主题为 "RISC-V and prpl: Why RISC-V will become the most secure processor architecture."。prpl foundation 以前一直是以MIPS为主，小编也很好奇它新的走向。期待 Art Swift 前辈的演讲 : )

连结：[link] (http://www.socconference.com/agenda.htm)

## 技术讨论

### SiFive召集工具链的版本测试贡献者

SiFive的Palmer，现在RISC-V Linux Kernel和GCC工具链的主要维护着，希望召集贡献者一同测试工具链。
这里说的测试是指Continueous Integration (CI)。即对每次的代码更新进行自动测试和隔夜测试。
这样的测试自动化能极大地保证工具链的稳定性和可靠性，是非常重要的工作。
现在测试集变得越来越大，同时需要测试的组合也变得复杂，单次代码更新已可能需要测试过夜，所以需要有专门的测试维护人员和分布式测试平台。

#### 详细的召集邮件列表：[https://goo.gl/568WYH](https://groups.google.com/a/groups.riscv.org/d/msg/sw-dev/HdkwlJF4JXA/0bfGtbNiBQAJ)

### 在LR/SC之间禁止所有中断

LR/SC是RISC-V支持复杂原子操作的方式。
LR指令读一个地址并对该地址上锁。
上锁后，处理器有16个周期完成一段小的原子操作片段。
片段完成后，SC指令尝试写原上锁地址，如果锁没有被破坏，则写操作成功。否则，原子操作片段重新执行。
任何对锁的直接操作，或者执行时间超过16个周期都会导致锁丢失。
同时，在LR/SC之间也禁止任何中断服务。这里不是说主动禁止中断服务，而是任何中断都会导致锁丢失。
这就引发了关于两个问题的确认：

- 即使是deligated 用户级别中断服务也会导致锁丢失。
- 这便导致原子操作片段中不能使用需要trap-and-emulate的指令，比如乘除法指令。实际上，spec规定无论硬件实现与否，都不要使用乘除法指令。

#### 相关讨论 [https://goo.gl/UAciir](https://groups.google.com/a/groups.riscv.org/d/msg/isa-dev/FKWUf92UYsg/qDWvkhY_AAAJ)

## 代码更新

### LLVM 进度更新

LLVM的RISC-V开发有了实质进展。
现在RV32I已经通过了所有的GCC测试，可以识别RV32IMAFD的汇编指令并能生成RV32IM的汇编代码。
并且更值得一提的是，现在RV64I也已经通过所有GCC测试。
在合作方面，Andes正在向Alex的LLVM开发中加入RVC支持。
现在的[LLVM](https://github.com/lowRISC/riscv-llvm)工程包含了48个补丁，修改了128个文件，超过1.1万行代码。
8个补丁已经被LLVM接受，还有5个正在审核中。

#### lowRISC的Alex写了一个非常详细的进度更新报告，更多细节请查阅http://www.lowrisc.org/blog/2017/09/moving-risc-v-llvm-forwards/

### TileLink拆分Acquire报文类型为AcquireBlock和AcquirePerm

Acquire是TileLink总线协议中TL-C兼容级别定义的一个报文类型，用于低级缓存向高级缓存申请一个缓存块的数据或者写权限。
根据不久之前讨论的关于[显式缓存操作指令](https://cnrv.io/bi-week-rpts/2017-07-20#explicit-cache-instruction-重启讨论)的支持，
有些内存写操作会完全覆盖原有数据，因而在申请缓存块时并不需要从高级缓存读回数据。
为了支持这种优化，现在Acquire报文被拆分为AcquireBlock和AcquirePerm类型，其中AcquireBlock为原有的Acquire操作。
AcquirePerm则只提高写权利但是不从高级缓存读回数据。

#### Rocket-Chip PR \#1030 [https://git.io/vd01p](https://github.com/freechipsproject/rocket-chip/pull/1030)

### Rocket 处理器的一级数据缓存发现疑似数据丢失错误

感谢sxu55同学，lowRISC最近又修复了一个疑似错误(还未被上游Rocket确认)。
这个错误发生在一级数据缓存。
假设使用MESI一致性协议，处理器在对一个缓存块进行第一次写操作时需要将状态从E状态升级为M状态，该状态改变只需在本地完成。
在这个修改的同时，如果二级缓存向该一级缓存发出请求失效该内存块，即申请将状态从E降为I，这里就出现了竞争。
如果降级先完成，写操作应当失败，并向二级缓存重新申请E状态。
如果升级先完成，二级缓存的降级请求仍然会成功，但是数据应当被返回至二级缓存。
为了避免冲突，一级数据缓存有相应的互锁机制。这里起作用的互锁机制是如果升级正在执行，二级缓存的降级请求应该被阻塞。
可是现在的硬件仿真发现，该锁晚了一个周期，导致降级操作以为自己先完成，同时写操作也完成，但是状态已经被改为I，写入数据丢失。
现在lowRISC版本的一级缓存将锁提前一个周期，避免了该冲突。

#### 详细的讨论和修复参见 lowRISC issue \#71 [https://git.io/vdVmo](https://github.com/lowRISC/lowrisc-chip/issues/71)

### 手动重定时(retiming)为Rocket处理器的FPU提速

带FPU的Rocket处理器在FPGA上的时钟频率一直较低，其中一个原因是FPGA软件不能很好地对FPU中的关键路径进行重定时优化。
为了提高FPGA实现的性能，SiFive的Henry Styles对FPU模块进行了手动寄存器优化。
现在带FPU的Rocket处理器已经可以在VC707(Virtex-7 485t)上跑到100MHz。

#### Rocket-Chip PR \#1021 [https://git.io/vd0Pm](https://github.com/freechipsproject/rocket-chip/pull/1021)
#### Rocket-Chip PR \#1032 [https://git.io/vd0PG](https://github.com/freechipsproject/rocket-chip/pull/1032)

### Rocket-Chip: 分离通用处理器相关配置和Rocket专有配置

Rocket-chip最近将Rocket处理器的专有配置从处理器配置中剥离。
此举更好地抽象了Rocket-Chip的处理器接口，有利于复用Rocket-Chip片上总线结构来链接非Rocket的处理器实现。
同时对于处理器相关的配置寄存器，建议的实现方式是使用一个和单个处理器紧相关的MMIO映射空间而不使用CSR。
使用CSR增加了汇编的难度，同时现在CSR的地址空间有限。

#### Rocket-Chip PR\#1023 [https://git.io/vdBwi](https://github.com/freechipsproject/rocket-chip/pull/1023)
#### Rocket-Chip PR\#1034 [https://git.io/vd0i8](https://github.com/freechipsproject/rocket-chip/pull/1034)

### 告别Chisel cloneType 重载

cloneType是Chisel中关于类型复制的重定义函数。
所有需要放入列表型数据类型，比如Vec和Seq的Bundle类型对象，都需要对cloneType进行重载。
这基本是一个重复性工作，但是忘记则会编译出错。
现在，Chisel将能够自己生成对应cloneType函数，终于不再需要设计者手动重载了！

#### Chisel3 PR \#653 [https://git.io/vdVOD](https://github.com/freechipsproject/chisel3/pull/653)

## 安全点评

## 微群热点

## 实用资料

## 行业视角

## 市场相关

## CNRV社区活动

## 暴走事件

### 十月

+ [OSDT开源开发工具大会2017](http://www.hellogcc.org/?p=34315)（也就是原HelloGCC会议）将在10月下旬在北京举办，时间暂定10月21日，话题和赞助征集已经开始。话题内容包括“面向RISCV等新硬件的基础软件支持”，各位不要错过。
+ [开源经济学研究-2017年年会邀请函](http://www.open-source-economics.org/open_source_economics_2017.html)
+ [First Workshop on Computer Architecture Research with RISC-V (CARRV 2017)](https://carrv.github.io/#first-workshop-on-computer-architecture-research-with-risc-v-carrv-2017), 14 October at Boston, Massachusetts, co-located with MICRO 2017.
+ [LLVM US dev meeting](https://llvm.org/devmtg/2017-10/#bof4)将在十月18-19日于加州San Jose举行。其中有一场跟risc-v有关的演讲。Alex Bradbury演讲的主题会是 "Co-ordinating RISC-V development in LLVM"。 有兴趣的可以参考。
+ [15th International SoC Conference](http://www.socconference.com/agenda.htm)将在十月18-19日于加州 Irvine 举行。其中有六场跟risc-v有关的演讲。

### 十一月

+ [The 7th RISC-V workshop](https://www.softconf.com/h/riscv7thwkshp/) 2017年11月28-30日，第7届RISC-V研讨会将在美国加州Milpitas由西部数据承办。
+ [BSDTW17](https://bsdtw.org/) 2017年11月11-12日，BSDTW17会有两场关于RISC-V的演讲，地点在台北。

## 招聘简讯

_CNRV提供为行业公司提供公益性质的一句话的招聘信息发布，若有任何体系结构、IC设计、软件开发的招聘信息，欢迎联系我们！_

----

整理编集: 宋威，郭雄飞，黄柏玮

----

**欢迎关注微信公众号CNRV，接收最新最时尚的RISC-V讯息！**

![CNRV微信公众号](/assets/images/cnrv_qr.png)

----

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。
