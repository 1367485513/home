---
layout: default
---

# RISC-V 双周简报 (2018-08-17)

要点新闻：


## RV新闻


## 技术讨论

### 如何在GCC中添加一条RISC-V指令

最近Jim Wilson在邮件列表中给出了一个非常完整的介绍，讲解如何在GCC的相关工具中添加一条RISC-V指令。

- binutils: 如果只是想在汇编的级别添加一条指令，那么只需要修改binutils而不用动编译器本身。
  Kito Cheng提供了.insn模板。使用改模板可以全面定制每一条汇编指令。
  不过，小修小改的话，直接修改binutils的代码可能来的更加方便。
  主要来说，需要将指令添加到opcodes/riscv-opc.c中，
  将指令的格式添加到include/opcode/riscv-opc.h中，
  格式中的各种缩写符号可以在gas/config/tc-riscv.c的riscv_ip()函数中找到。
- gcc自动生成: 如果需要让GCC能自动生成添加的指令，这就会麻烦很多。
  如果被添加的指令在一种明确的pattern出现时被使用，
  那么，在gcc/config/riscv/riscv.md中添加该pattern的描述即可。
  如果并不存在这种pattern，那么就需要修改和架构无关或相关的优化步骤，这样就会比较困难。
- 有限的资料：关于GCC可以看GCC的网站https://gcc.gnu.org/wiki/GettingStarted#Tutorials.2C_HOWTOs
  关于Binutils，可以看https://sourceware.org/binutils/binutils-porting-guide.txt
  不过Binutils的这个网站讲解不够详细。
  涉及到连接器优化的话，看这本书("Linkers and Loaders" by John R Levine)会更好。

更详细的讲解，请参看Jim Wilson的邮件原文: [sw-dev](https://groups.google.com/a/groups.riscv.org/d/msg/sw-dev/sL_OHXYj3LY/Gsm6sBc9BQAJ)

### 有关 GCC 生成 atomic 代码的问题

Roger Ferrer 在使用  riscv64-unknown-linux-gnu GCC 8.1 编译 atomic 相关的代码时发现行为跟他预期的不符。

```c
#include <stdatomic.h>

atomic_int x;
void foo(void) { atomic_fetch_add_explicit(&x, 5, memory_order_acq_rel); }
```

对于 atomic fetch 和 add， GCC 生成下列指令：

```asm
fence iorw,ow; amoadd.w.aq zero,a4,0(a5) 
```
而不是 

```asm
amoadd.w.aq zero,a4,0(a5) 
```

Roger Ferrer 查看了 RISCV 规范也没发现规定了 atomic 指令之前要加上 IO 的 fence 。

Jim Wilson 猜测是因为 memory model 还在制定中，没有确定下来，但对应到 C/C++ 的标准定义好了，GCC 超前做了多余的事情。

更详细的讲解，请参看邮件列表  [sw-dev](https://groups.google.com/a/groups.riscv.org/forum/#!msg/sw-dev/DsLpTq-IbW4/zfoAPwW4CAAJ）

## 代码更新

### lowRISC第6版: refresh v0.6

lowRISC即将发布其第6版SoC实现。
该版本使用了最新的Rocket-chip，在其基础上添加了多种外围设备。
该版本的主要更新包括：

- 使用2018年3月份的Rocket-chip作为SoC核心（GDB, PLIC）
- 处理器频率提高到50MHz
- 增强ethernet功能，在启动阶段支持DHCP
- 支持彩色的VGA终端
- 使用u-boot作为启动bootloader
- 支持Debian Linux

代码分支: [refresh-v0.6](https://github.com/lowRISC/lowrisc-chip/releases/tag/v0.6-rc1)

## 安全点评

## 微群热点

## 实用资料

### 编译QEMU的RISC-V映像

Tommy Murphy总结的关于编译QEMU RISC-V映像的网页

- https://github.com/riscv/riscv-qemu/wiki
- https://wiki.qemu.org/Documentation/Platforms/RISCV
- https://www.sifive.com/blog/2017/12/20/risc-v-qemu-part-1-privileged-isa-hifive1-virtio/
- https://www.sifive.com/blog/2018/04/25/risc-v-qemu-part-2-the-risc-v-qemu-port-is-upstream/

## 行业视角

## 市场相关


## CNRV社区活动

## CNRV网站更新

## 会议征稿


## 暴走事件

### 2018年10月

- 2018年10月18日, RISC-V Day Tokyo将在Keio University举办，演讲征集已经开始。[注册网站](https://tmt.knect365.com/risc-v-day-tokyo/)

### 2018年12月

- [RISC-V Summit in Santa Clara (Dec. 3-5)](http://cts.businesswire.com/ct/CT?id=smartlink&url=https%3A%2F%2Ftmt.knect365.com%2Frisc-v-summit%2F&esheet=51792917&newsitemid=20180423005251&lan=en-US&anchor=RISC-V+Summit+in+Santa+Clara&index=4&md5=88ca965085b5b1b9b6ea996333f27e44)

## 招聘简讯

_CNRV提供为行业公司提供公益性质的一句话的招聘信息发布，若有任何体系结构、IC设计、软件开发的招聘信息，欢迎联系我们！_

----

整理编集: 宋威、黄柏玮、汪平、林容威、傅炜、巍巍、郭雄飞、黄玮


----

**欢迎关注微信公众号CNRV，接收最新最时尚的RISC-V讯日, RISC-V Day Tokyo将在Keio University举办，演讲征集已经开始。[注册网站](https://tmt.knect365.com/risc-v-day-tokyo/)
息！**

![CNRV微信公众号](/assets/images/cnrv_qr.png)

----

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。

